<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Choose your project</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.17/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/footer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Choose your project
]
.institute[
### UNSW Data Science Hub
]
.date[
### 21-11-2022
]

---

layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;UNSW Data Science Hub / &lt;a href='https://www.unsw.edu.au/research/udash'&gt;uDASH&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;

&lt;!-- this adds the link footer to all slides, depends on my-footer class in css--&gt;

<div>
<style type="text/css">.xaringan-extra-logo {
width: 110px;
height: 128px;
z-index: 0;
background-image: url(images/uDASH-logo.jpg);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:1em;right:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>








---

class: inverse, center, middle

# Climate: Weather &amp; Air Quality in Schools

&gt; Good air quality in Sydney was something that many of us took for granted until the Black Summer Bushfires in 2019-2020. From serious health effects to general inconvenience, it was suddenly hard to ignore just how important the air we breathe truly is. However, fires aren’t the only phenomenon that can impact our air quality: urbanisation, pollution, and weather events can all influence our health and wellbeing. 

***Can we predict air quality at UNSW using information about the weather?***

---

## Weather &amp; Air Quality ...

This dataset contains 115 different variables documenting local weather and air quality measured at 12 different sites around Sydney.
We break these variables up into

- Weather-related variables: temperature `t`, relative humidity `rh`, air pressure `p`, rainfall `rain`, wind direction `wd`, and wind speed `ws`, and
- Air-quality related variables: concentrations of nitrogen dioxide `no2`, sulphur dioxide `so2`, carbon monoxide `co`, ozone `o3`, particulate matter &lt;2.5μm `pm25`, and particulate matter &lt;10μm `pm10`.

We also have the time and date of each measurement.
Since measurements are taken every 20 minutes, we have 43771 data points!

---

## Weather &amp; Air Quality ... Data

The data is available from [TERN](https://www.kaggle.com/datasets/destring/metacritic-reviewed-games-since-2000), and will be provided by uDASH staff.



```r
# reading in data
airqual &lt;- read_csv("data/air-quality.csv") %&gt;%
  # nice names
  clean_names()

# preview 
airqual %&gt;% 
  head(3)
```

```
## # A tibble: 3 × 115
##   time                ludd_no2 ludd_so2 ludd_co ludd_o3 ludd_pm25 ludd_…¹ ludd_t
##   &lt;dttm&gt;                 &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 2019-09-01 00:00:00    0.013    0.031   0.058   0.01        2.3     7.3   17.3
## 2 2019-09-01 00:20:00    0.003    0.025   0.051   0.019       2.3     8.2   18.6
## 3 2019-09-01 00:40:00    0.011    0.023   0.032   0.019       2       4.7   19.5
## # … with 107 more variables: ludd_rh &lt;dbl&gt;, ludd_p &lt;dbl&gt;, ludd_rain &lt;dbl&gt;,
## #   ludd_wd &lt;dbl&gt;, ludd_ws &lt;dbl&gt;, broo_no2 &lt;dbl&gt;, broo_so2 &lt;dbl&gt;,
## #   broo_co &lt;dbl&gt;, broo_o3 &lt;dbl&gt;, broo_pm25 &lt;dbl&gt;, broo_pm10 &lt;dbl&gt;,
## #   broo_t &lt;dbl&gt;, broo_rh &lt;dbl&gt;, broo_p &lt;dbl&gt;, broo_rain &lt;dbl&gt;, broo_wd &lt;dbl&gt;,
## #   broo_ws &lt;dbl&gt;, dulw_t &lt;dbl&gt;, dulw_rh &lt;dbl&gt;, dulw_p &lt;dbl&gt;, dulw_rain &lt;dbl&gt;,
## #   dulw_wd &lt;dbl&gt;, dulw_ws &lt;dbl&gt;, glen_no2 &lt;dbl&gt;, glen_so2 &lt;dbl&gt;,
## #   glen_co &lt;dbl&gt;, glen_o3 &lt;dbl&gt;, glen_pm25 &lt;dbl&gt;, glen_pm10 &lt;dbl&gt;, …
```

---

## Weather &amp; Air Quality ... Cleaning and transformation

We're lucky that the data has already been cleaned.
However, we do notice that the times given are in UTC rather than local time.
Fortunately (if we ignore daylight savings) this is easy to fix!


```r
airqual &lt;- airqual %&gt;%
  # Sydney (AEST) is UTC +10 
  mutate(time_local = time + hours(10))
```

---

## Weather &amp; Air Quality ... Cleaning and transformation

Also, the data is in a bit of an inconvenient format: we have 116 columns where each column corresponds to a specific school and variable combination.
It would be easier for us if there was simply a column for each variable and a column saying when and where the measurement was taken.
Fortunately we can fix that!


```r
# changing column structure of data
airqual_wide &lt;- airqual %&gt;% 
  # now that we have local time don't need utc
  select(-time) %&gt;%
  pivot_longer(-time_local) %&gt;%
  mutate(var_type = as.factor(str_sub(name, start = 6)),
         location = as.factor(str_sub(name, end = 4))) %&gt;%
  select(-name) %&gt;%
  # wider back to the format we want
  pivot_wider(names_from = var_type, values_from = value)
```

---

## Weather &amp; Air Quality ... Cleaning and transformation

Lastly, we ignore the schools where there is no air quality data. 


```r
school_with_airqual_measurements &lt;- airqual_wide %&gt;%
  group_by(location) %&gt;% 
  select(pm10) %&gt;% # using pm10 to check if have any air quality measurements 
  summarise(num_measurements = sum(!is.na(pm10))) %&gt;%
  ungroup() %&gt;%
  # select only school with non-zero amount of measurements
  filter(num_measurements &gt; 0) %&gt;%
  # get list of schools
  pull(location)

# only want data from schools in the list we created
airqual_clean &lt;- airqual_wide %&gt;% 
  filter(location %in% school_with_airqual_measurements)
```

---

## Weather &amp; Air Quality ...  Explore

There are so many different questions we could explore with this data, but here we are going to examine nitrogen dioxide (NO&lt;sub&gt;2&lt;/sub&gt;) concentrations around UNSW in January 2021.
NO&lt;sub&gt;2&lt;/sub&gt; causes respiratory problems and reacts with other compounds in the air to form more pollutants including PM2.5, PM10, and ozone (O&lt;sub&gt;3&lt;/sub&gt;).
As NO&lt;sub&gt;2&lt;/sub&gt; is often related to burning fossil fuels, it's concentration is often related to cars and traffic.
Hence, we're going to pay specific attention to the day of the week and the time of the day.



```r
# restricting to get UNSW data
unsw_data &lt;- airqual_clean %&gt;% 
  # only unsw
  filter(location == "unsw") %&gt;%
  # Jan 2021
  filter(time_local &gt; "2021-01-01" &amp; time_local &lt; "2021-02-01") %&gt;%
  # need no2 measurements
  drop_na(no2) %&gt;%
  # only weather variables, time, and no2
  select(time_local, no2, t, rh, p, rain, wd, ws) %&gt;%
  # get hour of the day
  mutate(hour = hour(time_local)) %&gt;%
  # get day of the week
  mutate(dow = as.factor(wday(time_local)))
```

---

## Weather &amp; Air Quality ...  Explore

.pull-left[

```r
# plotting relationship between no2 and key variables
unsw_data %&gt;%
  select(hour, t, rh, no2) %&gt;%
  pivot_longer(-no2) %&gt;%
  ggplot(aes(x = value, y = no2)) + 
  geom_point() + 
  facet_wrap(~ name, scales = "free_x", nrow = 2) +
  xlab("") + 
  theme(axis.text.y = element_blank())
```
]

.pull-right[
&lt;img src="Air_quality_dataset_files/figure-html/game-eda-out1-1.png" width="100%" /&gt;
]

---

## Weather &amp; Air Quality ...  Explore

.pull-left[

```r
# now looking at the categorical variable: day of the week
unsw_data %&gt;%
  ggplot(aes(x = dow, y = no2)) + 
  geom_boxplot()
```
]

.pull-right[
&lt;img src="Air_quality_dataset_files/figure-html/game-eda-out2-1.png" width="100%" /&gt;
]

---

## Weather &amp; Air Quality ... Model

We noticed a strong relationship between temperature, relative humidity, and NO&lt;sub&gt;2&lt;/sub&gt; concentrations. There is also some sort of cyclical relationship with the time of the day, which we can also model within multiple linear regression using `\(sin\)` and `\(cos\)` terms. 


```r
# fitting multiple linear regression
model &lt;- lm( no2 ~ sin(hour*pi/12) + cos(hour*pi/12) + t + rh + dow, 
             data = unsw_data)
```

---

## Weather &amp; Air Quality ... Model


```r
# examining fitted model
model %&gt;%
  summary()
```

```
## 
## Call:
## lm(formula = no2 ~ sin(hour * pi/12) + cos(hour * pi/12) + t + 
##     rh + dow, data = unsw_data)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.042133 -0.010678  0.001112  0.010095  0.128299 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       -4.268e-02  6.458e-03  -6.609 5.88e-11 ***
## sin(hour * pi/12)  5.869e-04  6.318e-04   0.929  0.35311    
## cos(hour * pi/12) -2.078e-03  7.669e-04  -2.709  0.00684 ** 
## t                  3.697e-03  2.021e-04  18.293  &lt; 2e-16 ***
## rh                -2.399e-04  4.367e-05  -5.494 4.82e-08 ***
## dow2               4.916e-03  1.497e-03   3.285  0.00105 ** 
## dow3               6.368e-03  1.942e-03   3.279  0.00107 ** 
## dow4              -1.092e-02  1.709e-03  -6.388 2.42e-10 ***
## dow5              -2.992e-03  1.448e-03  -2.066  0.03904 *  
## dow6               6.717e-03  1.386e-03   4.846 1.43e-06 ***
## dow7              -1.850e-03  1.362e-03  -1.358  0.17463    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.01433 on 1160 degrees of freedom
##   (22 observations deleted due to missingness)
## Multiple R-squared:  0.4741,	Adjusted R-squared:  0.4695 
## F-statistic: 104.6 on 10 and 1160 DF,  p-value: &lt; 2.2e-16
```

---

## Weather &amp; Air Quality ... Evaluation

We can compare predictions from our model to the observed results. 
If our model was perfect, all the points should lie on the blue line.
We can see our model particularly struggles to predict the days were there are very low NO&lt;sub&gt;2&lt;/sub&gt; concentrations - can you suggest why? 
Also our model predicts some negative concentrations - we can definitely keep making this model better!

.pull-left[

```r
# combining predictions with data
cbind(unsw_data, pred = predict(model, newdata = unsw_data)) %&gt;%
  ggplot(aes(x = no2, y = pred)) + 
  geom_point() +
  geom_abline(slope = 1, intercept = 0, color = "blue")
```
]

.pull-right[
&lt;img src="Air_quality_dataset_files/figure-html/game-viz-out-1.png" width="100%" /&gt;
]



---


# Thanks!

[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> @uDASH_UNSW](https://twitter.com/uDASH_UNSW)

[<svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"/></svg> //www.unsw.edu.au/research/udash](https://www.unsw.edu.au/research/udash)

[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M501.6 4.186c-7.594-5.156-17.41-5.594-25.44-1.063L12.12 267.1C4.184 271.7-.5037 280.3 .0431 289.4c.5469 9.125 6.234 17.16 14.66 20.69l153.3 64.38v113.5c0 8.781 4.797 16.84 12.5 21.06C184.1 511 188 512 191.1 512c4.516 0 9.038-1.281 12.99-3.812l111.2-71.46l98.56 41.4c2.984 1.25 6.141 1.875 9.297 1.875c4.078 0 8.141-1.031 11.78-3.094c6.453-3.625 10.88-10.06 11.95-17.38l64-432C513.1 18.44 509.1 9.373 501.6 4.186zM369.3 119.2l-187.1 208.9L78.23 284.7L369.3 119.2zM215.1 444v-49.36l46.45 19.51L215.1 444zM404.8 421.9l-176.6-74.19l224.6-249.5L404.8 421.9z"/></svg> uDASH@unsw.edu.au](mailto:uDASH@unsw.edu.au )

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "solarized-dark",
"highlightLines": true,
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
(function(time) {
  var d2 = function(number) {
    return ('0' + number).slice(-2); // left-pad 0 to minutes/seconds
  },

  time_format = function(total) {
    var secs = Math.abs(total) / 1000;
    var h = Math.floor(secs / 3600);
    var m = Math.floor(secs % 3600 / 60);
    var s = Math.round(secs % 60);
    var res = d2(m) + ':' + d2(s);
    if (h > 0) res = h + ':' + res;
    return res;  // [hh:]mm:ss
  },

  slide_number_div = function(i) {
    return document.getElementsByClassName('remark-slide-number').item(i);
  },

  current_page_number = function(i) {
    return slide_number_div(i).firstChild.textContent;  // text "i / N"
  };

  var timer = document.createElement('span'); timer.id = 'slide-time-left';
  var time_left = time, k = slideshow.getCurrentSlideIndex(),
      last_page_number = current_page_number(k);

  setInterval(function() {
    time_left = time_left - 1000;
    timer.innerHTML = ' ' + time_format(time_left);
    if (time_left < 0) timer.style.color = 'red';
  }, 1000);

  slide_number_div(k).appendChild(timer);

  slideshow.on('showSlide', function(slide) {
    var i = slide.getSlideIndex(), n = current_page_number(i);
    // reset timer when a new slide is shown and the page number is changed
    if (last_page_number !== n) {
      time_left = time; last_page_number = n;
      timer.innerHTML = ' ' + time_format(time); timer.style.color = null;
    }
    slide_number_div(i).appendChild(timer);
  });
})(60000);
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
